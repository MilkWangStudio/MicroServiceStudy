# 软件项目架构方案演进
大家提到项目架构的时候，脑海里会想到什么？  
一般脑海里可能会立刻冒出一些词：前后端分离、MVC、单体应用、分布式、微服务。  
我在网上搜了一下架构方案，还有一堆接触比较少的技术名词：DDD、SOA、ServiceMesh、Serverless、云原生。  

其实这些都是架构方案，只是讨论的角度不太一样，对上面这些方案简单做一下划分，帮助大家理解。  
- 架构风格：单体应用、分布式、微服务
- 代码分层：前后端分离、MVC、DDD
- 运维方案：ServiceMesh、Serverless
- 特殊：云原生

云原生比较特殊，它其实指一堆概念、落地方案的聚合，包括容器化、微服务、devops等，属于是提供了一个云上的最佳实践，每家云厂商都在做，当然具体实现标准就各有差异了。  

本章将以 _**架构风格**_ 的演进为主线，理清为什么会有这么多架构方案，他们又都解决了什么问题。  

## 小徐的创业史
我们假设有一个叫小徐的同学，他在互联网初期用PHP创建了一个叫“MikuFans”的视频网站。  
### 阶段一: 单体应用
![alt 单体应用](http://assets.processon.com/chart_image/6350b39b1efad4167899b0b1.png)  

用户的请求经过代理后会打到某一台机器上，然后从PHP模板引擎拿到HTML渲染页面。  
#### 前后端分离
因为只有小徐一个人开发，所以前后端是[模板引擎](./resource/TemplateEngine.md)的合作方式。无论是页面、接口修改，都在一个项目里处理掉了，一个访问首页的接口大概是这样：

```API
GET /home.html
Response: 
<div v-for="{{Video in VideoList}}">
    <VideoComponent data={{Video}}/>
</div>
```
![模板引擎页面渲染流程](http://assets.processon.com/chart_image/6350ee72637689070a62b942.png)


小徐开发的很开心，有什么功能先后端在一个项目里，一梭子就搞完了。但是随着用户提的需求越来越多，小徐招了一个前端来帮他分担工作。这位前端小伙伴只会写JS，不会PHP。所以没法改PHP项目里的模板页面。    

经过沟通后他们决定前端小伙先写静态页面，写完之后把代码发给小徐，然后小徐把页面代码改成PHP模板引擎的语法。  

![模板引擎工作方式](http://assets.processon.com/chart_image/6350e5c07d9c080747604468.png)  

两个人开发迭代果然快很多，网站用户变多了，又开始扩充团队。这时候小徐开始忙不过来了，前端想改个颜色都得让小徐重新发布后端项目。小徐总结了下这种视图层和接口层混在一起的方案有这么几个问题：
- 前后端职责不清晰，比如一些条件渲染、循环渲染，是js写还是php写？
- 页面样式会频繁修改发版，但是后端服务希望越少发版越好，最好一周上线一次
- 用户打开页面需要等后台数据查询完成

这时候开始尝试把前端项目单独部署，小徐在线上给前端团队开了一台服务器，页面请求会被路由到这台服务器上。  
原来打开页面一个请求到PHP，用模板引擎拼装好数据后，页面直接可以渲染出来。但是现在前端资源服务器上只有静态的页面，浏览器打开后再通过HTTP请求查询后台服务。整个请求的链路大概是这样的：  
